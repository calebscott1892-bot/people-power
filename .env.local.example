You are editing my People Power project.

Bug I’m seeing in the browser:

- Frontend (Vite dev) runs on http://localhost:5173
- Home page calls: /api/movements?limit=20&offset=0&fields=id,title,summary,tags,author_email,creator_email,city,region,country,location_city,location_region,location_country,location_lat,location_lon,momentum_score,upvotes,downvotes,score,verified_participants,unverified_participants,supporters,created_at,updated_at,created_date
- That request is returning HTTP 500.

Known working bits:

- Backend is `node Server/index.js`
- GET http://localhost:3001/health returns: { ok: true, status: 'healthy', ... }
- GET http://localhost:3001/movements (with NO query string) returns a test “migration-mode fallback” movement and works.

So the problem is specifically: GET /movements WITH query params (limit, offset, fields, etc.) is throwing and returning 500.

Your tasks:

1. Open `Server/index.js` and find the Fastify route handler for:
   - `fastify.get('/movements', ...)`

2. Make this handler **robust to ANY query params**:
   - Accept `limit`, `offset`, and `fields` as OPTIONAL.
   - Treat `limit` and `offset` as numbers, with safe defaults if parsing fails:
     - default limit = 20
     - default offset = 0
   - Treat `fields` as an optional comma-separated string.
   - If validation fails, do NOT throw – just fall back to default values or ignore the field.

3. Wrap the whole handler logic in try/catch:
   - On success: return the normal movement list.
   - On ANY error (e.g. Supabase error, bad query, unexpected data), do NOT crash:
     - Log a concise error with Fastify’s logger (fastify.log.error(err)).
     - Return HTTP 200 with a safe fallback payload, e.g.:

       ```js
       reply.send({
         ok: true,
         movements: [
           {
             id: 'test-movement-1',
             title: 'Test Movement',
             description: 'This is a test movement served from migration-mode fallback storage.',
             tags: ['demo'],
             created_at: new Date().toISOString(),
             momentum_score: 0,
             upvotes: 0,
             downvotes: 0,
             score: 0,
           },
         ],
       });
       ```

     - IMPORTANT: even when falling back, do not include stack traces or internal error details in the JSON response.

4. Make sure unknown query params (like `fields`) **never cause a 500**:
   - If you’re using zod or similar, configure the schema to:
     - `.passthrough()` or explicitly ignore extra keys,
     - OR just use manual parsing for now (no throwing on unknown keys).

5. After changes, add a very short comment above the route, like:

   ```js
   // NOTE: /movements is hardened to never 500 due to query params; on error it falls back to a safe test movement.# Frontend environment variables (Vite)
# Copy to .env.local (DO NOT commit .env.local with secrets)

# Legacy REST clients in this repo use VITE_API_BASE_URL (Fastify dev server)
# VITE_API_BASE_URL=http://127.0.0.1:3001

# New app-owned client surface (src/api/appClient.js)
# Recommended with the Vite proxy (vite.config.js):
VITE_APP_API_BASE_URL=relative

# Or point directly at a running Worker:
# VITE_APP_API_BASE_URL=http://127.0.0.1:8787
